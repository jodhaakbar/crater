var Ie=Object.defineProperty,Pe=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var ue=(e,o,t)=>o in e?Ie(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,N=(e,o)=>{for(var t in o||(o={}))Se.call(o,t)&&ue(e,t,o[t]);if(ce)for(var t of ce(o))Te.call(o,t)&&ue(e,t,o[t]);return e},W=(e,o)=>Pe(e,ke(o));import{q as se,g as ee,d as me,c as te,p as pe,e as ye,T as xe,j as Ce,u as Me}from"./main.1c5aa925.js";import{D as De,d as Ve}from"./DragIcon.aece8a77.js";import{i as X,j as je,am as ae,g as oe,k as w,D as fe,r as x,o as r,c as p,t as n,x as y,b as s,a5 as qe,y as a,w as l,v as U,s as k,A as E,u as Le,l as he,m as j,n as H,b4 as ne,a4 as Z,aZ as Ee,q as ge,a0 as R,F as J,H as Q,G as be,ac as Oe,a6 as Ne,z as K,T as Ue,a7 as Fe,a8 as Ae,p as ze,M as We,B as Ye}from"./vendor.060aaec3.js";import{_ as Re}from"./SelectNotePopup.4ee6a867.js";const Ge={class:"flex items-center justify-between mb-3"},Xe={class:"flex items-center text-base",style:{flex:"4"}},He={class:"pr-2 mb-0",align:"right"},Ze={class:"absolute left-3.5"},Je={class:"ml-2 text-sm leading-none text-primary-400 cursor-pointer"},Ke=n("br",null,null,-1),Qe={class:"text-sm text-right",style:{flex:"3"}},et={class:"flex items-center justify-center w-6 h-10 mx-2 cursor-pointer"},tt={props:{ability:{type:String,default:""},store:{type:Object,default:null},storeProp:{type:String,default:""},itemIndex:{type:Number,required:!0},index:{type:Number,required:!0},taxData:{type:Object,required:!0},taxes:{type:Array,default:[]},total:{type:Number,default:0},totalTax:{type:Number,default:0},currency:{type:[Object,String],required:!0},updateItems:{type:Function,default:()=>{}}},emits:["remove","update"],setup(e,{emit:o}){const t=e,h=se(),$=ee(),v=me(),B=X(null),u=je(N({},t.taxData));ae("utils");const{t:M}=oe(),C=w(()=>h.taxTypes.map(b=>N({},b)).map(b=>(t.taxes.find(f=>f.tax_type_id===b.id)?b.disabled=!0:b.disabled=!1,b))),T=w(()=>u.compound_tax&&t.total?(t.total+t.totalTax)*u.percent/100:t.total&&u.percent?t.total*u.percent/100:0);fe(()=>t.total,()=>{S()}),fe(()=>t.totalTax,()=>{S()}),t.taxData.tax_type_id>0&&(B.value=h.taxTypes.find(d=>d.id===t.taxData.tax_type_id)),S();function q(d){u.percent=d.percent,u.tax_type_id=d.id,u.compound_tax=d.compound_tax,u.name=d.name,S()}function S(){u.tax_type_id!==0&&o("update",{index:t.index,item:W(N({},u),{amount:T.value})})}function i(){let d={itemIndex:t.itemIndex,taxIndex:t.index};$.openModal({title:M("settings.tax_types.add_tax"),componentName:"TaxTypeModal",data:d,size:"sm"})}function g(d){t.store.$patch(b=>{b[t.storeProp].items[t.itemIndex].taxes.splice(d,1)})}return(d,b)=>{const D=x("BaseIcon"),f=x("BaseMultiselect"),_=x("BaseFormatMoney");return r(),p("div",Ge,[n("div",Xe,[n("label",He,y(d.$t("invoices.item.tax")),1),s(f,{modelValue:B.value,"onUpdate:modelValue":[b[0]||(b[0]=I=>B.value=I),b[1]||(b[1]=I=>q(I))],"value-prop":"id",options:a(C),placeholder:d.$t("general.select_a_tax"),"open-direction":"top","track-by":"name",searchable:"",object:"",label:"name"},qe({singlelabel:l(({value:I})=>[n("div",Ze,y(I.name)+" - "+y(I.percent)+" % ",1)]),option:l(({option:I})=>[U(y(I.name)+" - "+y(I.percent)+" % ",1)]),_:2},[a(v).hasAbilities(e.ability)?{name:"action",fn:l(()=>[n("button",{type:"button",class:"flex items-center justify-center w-full px-2 cursor-pointer py-2 bg-gray-200 border-none outline-none",onClick:i},[s(D,{name:"CheckCircleIcon",class:"h-5 text-primary-400"}),n("label",Je,y(d.$t("invoices.add_new_tax")),1)])])}:void 0]),1032,["modelValue","options","placeholder"]),Ke]),n("div",Qe,[s(_,{amount:a(T),currency:e.currency},null,8,["amount","currency"])]),n("div",et,[e.taxes.length&&e.index!==e.taxes.length-1?(r(),k(D,{key:0,name:"TrashIcon",class:"h-5 text-gray-700 cursor-pointer",onClick:b[2]||(b[2]=I=>g(e.index))})):E("",!0)])])}}},ot={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},nt={colspan:"8",class:"p-0 text-left align-top"},st={class:"w-full"},at=n("col",{style:{width:"25%","min-width":"280px"}},null,-1),rt=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),it=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),lt={key:0,style:{width:"15%","min-width":"160px"}},dt=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),ct={class:"px-5 py-4 text-left align-top"},ut={class:"flex justify-start"},mt={class:"flex items-center justify-center w-5 h-5 mt-2 text-gray-300 cursor-move handle mr-2"},pt={class:"px-5 py-4 text-right align-top"},yt={class:"px-5 py-4 text-right align-top"},xt={class:"px-5 py-4 text-right align-top"},ft={class:"px-5 py-4 text-left align-top"},ht={class:"flex flex-col"},gt={class:"flex-auto flex-fill bd-highlight"},bt={style:{"min-width":"150px"},class:"relative w-full"},vt={key:0,class:"px-5 py-4 text-left align-top"},_t={class:"flex flex-col"},$t={class:"flex",style:{width:"120px"},role:"group"},wt={class:"flex items-center"},Bt={class:"px-5 py-4 text-right align-top"},It={style:{"min-width":"200px"},class:"flex items-center justify-end text-sm"},Pt={class:"flex items-center justify-center w-6 h-10 mx-2"},kt={key:0},St=n("td",{class:"px-5 py-4 text-left align-top"},null,-1),Tt={colspan:"4",class:"px-5 py-4 text-left align-top"},Ct={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(e,{emit:o}){const t=e,h=te(),$=pe();Le();const{t:v}=oe(),B=w({get:()=>t.itemData.quantity,set:c=>{O("quantity",parseFloat(c))}}),u=w({get:()=>t.itemData.width,set:c=>{O("width",parseFloat(c))}}),M=w({get:()=>t.itemData.length,set:c=>{O("length",parseFloat(c))}}),C=w({get:()=>{const c=t.itemData.price;return parseFloat(c)>0?c/100:c},set:c=>{if(parseFloat(c)>0){let m=Math.round(c*100);O("price",m)}else O("price",c)}}),T=w(()=>t.itemData.price*t.itemData.quantity*t.itemData.width*t.itemData.length),q=w({get:()=>t.itemData.discount,set:c=>{t.itemData.discount_type==="percentage"?O("discount_val",T.value*c/100):O("discount_val",Math.round(c*100)),O("discount",c)}}),S=w(()=>T.value-t.itemData.discount_val),i=w(()=>t.currency?t.currency:h.selectedCompanyCurrency),g=w(()=>t.store[t.storeProp].items.length!=1),d=w(()=>Math.round(he.exports.sumBy(t.itemData.taxes,function(c){return c.compound_tax?0:c.amount}))),b=w(()=>Math.round(he.exports.sumBy(t.itemData.taxes,function(c){return c.compound_tax?c.amount:0}))),D=w(()=>d.value+b.value),f={name:{required:j.withMessage(v("validation.required"),H)},quantity:{required:j.withMessage(v("validation.required"),H),minValue:j.withMessage(v("validation.qty_must_greater_than_zero"),ne(0)),maxLength:j.withMessage(v("validation.amount_maxlength"),Z(20))},width:{required:j.withMessage(v("validation.required"),H),minValue:j.withMessage(v("validation.qty_must_greater_than_zero"),ne(0)),maxLength:j.withMessage(v("validation.amount_maxlength"),Z(20))},length:{required:j.withMessage(v("validation.required"),H),minValue:j.withMessage(v("validation.qty_must_greater_than_zero"),ne(0)),maxLength:j.withMessage(v("validation.amount_maxlength"),Z(20))},price:{required:j.withMessage(v("validation.required"),H),minValue:j.withMessage(v("validation.number_length_minvalue"),ne(1)),maxLength:j.withMessage(v("validation.price_maxlength"),Z(20))},discount_val:{between:j.withMessage(v("validation.discount_maxlength"),Ee(0,w(()=>T.value)))},description:{maxLength:j.withMessage(v("validation.notes_maxlength"),Z(65e3))}},_=ge(f,w(()=>t.store[t.storeProp].items[t.index]),{$scope:t.itemValidationScope});function I(c){t.store.$patch(P=>{P[t.storeProp].items[t.index].taxes[c.index]=c.item});let m=t.itemData.taxes[t.itemData.taxes.length-1];(m==null?void 0:m.tax_type_id)!==0&&t.store.$patch(P=>{P[t.storeProp].items[t.index].taxes.push(W(N({},xe),{id:be.raw()}))}),A()}function G(c){O("name",c)}function F(c){t.store.$patch(m=>{if(m[t.storeProp].items[t.index].name=c.name,m[t.storeProp].items[t.index].price=c.price,m[t.storeProp].items[t.index].item_id=c.id,m[t.storeProp].items[t.index].description=c.description,c.unit&&(m[t.storeProp].items[t.index].unit_name=c.unit.name),t.store[t.storeProp].tax_per_item==="YES"&&c.taxes){let P=0;c.taxes.forEach(z=>{I({index:P,item:N({},z)}),P++})}m[t.storeProp].exchange_rate&&(m[t.storeProp].items[t.index].price/=m[t.storeProp].exchange_rate)}),$.fetchItems(),A()}function L(){t.itemData.discount_type!=="fixed"&&(O("discount_val",Math.round(t.itemData.discount*100)),O("discount_type","fixed"))}function Y(){t.itemData.discount_type!=="percentage"&&(O("discount_val",T.value*t.itemData.discount/100),O("discount_type","percentage"))}function A(){var P,z;let c=(z=(P=t.store[t.storeProp])==null?void 0:P.items[t.index])==null?void 0:z.taxes;c||(c=[]);let m=W(N({},t.store[t.storeProp].items[t.index]),{index:t.index,total:S.value,sub_total:T.value,totalSimpleTax:d.value,totalCompoundTax:b.value,totalTax:D.value,tax:D.value,taxes:[...c]});t.store.updateItem(m)}function O(c,m){t.store.$patch(P=>{P[t.storeProp].items[t.index][c]=m}),A()}return(c,m)=>{const P=x("BaseItemSelect"),z=x("BaseInput"),ve=x("BaseMoney"),re=x("BaseIcon"),_e=x("BaseButton"),ie=x("BaseDropdownItem"),$e=x("BaseDropdown"),le=x("BaseContentPlaceholdersText"),de=x("BaseContentPlaceholders"),we=x("BaseFormatMoney");return r(),p("tr",ot,[n("td",nt,[n("table",st,[n("colgroup",null,[at,rt,it,e.store[e.storeProp].discount_per_item==="YES"?(r(),p("col",lt)):E("",!0),dt]),n("tbody",null,[n("tr",null,[n("td",ct,[n("div",ut,[n("div",mt,[s(De)]),s(P,{type:"Invoice",item:e.itemData,invalid:a(_).name.$error,"invalid-description":a(_).description.$error,taxes:e.itemData.taxes,index:e.index,"store-prop":e.storeProp,store:e.store,onSearch:G,onSelect:F},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),n("td",pt,[s(z,{modelValue:a(u),"onUpdate:modelValue":m[0]||(m[0]=V=>R(u)?u.value=V:null),invalid:a(_).width.$error,"content-loading":e.loading,type:"number",small:"",min:"0",step:"any",onChange:m[1]||(m[1]=V=>A()),onInput:m[2]||(m[2]=V=>a(_).width.$touch())},null,8,["modelValue","invalid","content-loading"])]),n("td",yt,[s(z,{modelValue:a(M),"onUpdate:modelValue":m[3]||(m[3]=V=>R(M)?M.value=V:null),invalid:a(_).length.$error,"content-loading":e.loading,type:"number",small:"",min:"0",step:"any",onChange:m[4]||(m[4]=V=>A()),onInput:m[5]||(m[5]=V=>a(_).length.$touch())},null,8,["modelValue","invalid","content-loading"])]),n("td",xt,[s(z,{modelValue:a(B),"onUpdate:modelValue":m[6]||(m[6]=V=>R(B)?B.value=V:null),invalid:a(_).quantity.$error,"content-loading":e.loading,type:"number",small:"",min:"0",step:"any",onChange:m[7]||(m[7]=V=>A()),onInput:m[8]||(m[8]=V=>a(_).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),n("td",ft,[n("div",ht,[n("div",gt,[n("div",bt,[s(ve,{key:a(i),modelValue:a(C),"onUpdate:modelValue":m[9]||(m[9]=V=>R(C)?C.value=V:null),invalid:a(_).price.$error,"content-loading":e.loading,currency:a(i)},null,8,["modelValue","invalid","content-loading","currency"])])])])]),e.store[e.storeProp].discount_per_item==="YES"?(r(),p("td",vt,[n("div",_t,[n("div",$t,[s(z,{modelValue:a(q),"onUpdate:modelValue":m[10]||(m[10]=V=>R(q)?q.value=V:null),invalid:a(_).discount_val.$error,"content-loading":e.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"]),s($e,{position:"bottom-end"},{activator:l(()=>[s(_e,{"content-loading":e.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:l(()=>[n("span",wt,[U(y(e.itemData.discount_type=="fixed"?e.currency.symbol:"%")+" ",1),s(re,{name:"ChevronDownIcon",class:"w-4 h-4 text-gray-500 ml-1"})])]),_:1},8,["content-loading"])]),default:l(()=>[s(ie,{onClick:L},{default:l(()=>[U(y(c.$t("general.fixed")),1)]),_:1}),s(ie,{onClick:Y},{default:l(()=>[U(y(c.$t("general.percentage")),1)]),_:1})]),_:1})])])])):E("",!0),n("td",Bt,[n("div",It,[n("span",null,[e.loading?(r(),k(de,{key:0},{default:l(()=>[s(le,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),k(we,{key:1,amount:a(S),currency:a(i)},null,8,["amount","currency"]))]),n("div",Pt,[a(g)?(r(),k(re,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:m[11]||(m[11]=V=>e.store.removeItem(e.index))})):E("",!0)])])])]),e.store[e.storeProp].tax_per_item==="YES"?(r(),p("tr",kt,[St,n("td",Tt,[e.loading?(r(),k(de,{key:0},{default:l(()=>[s(le,{lines:1,class:"w-24 h-8 rounded-md border"})]),_:1})):(r(!0),p(J,{key:1},Q(e.itemData.taxes,(V,Be)=>(r(),k(tt,{key:V.id,index:Be,"item-index":e.index,"tax-data":V,taxes:e.itemData.taxes,"discounted-total":a(S),"total-tax":a(d),total:a(T),currency:e.currency,"update-items":A,ability:a(ye).CREATE_INVOICE,store:e.store,"store-prop":e.storeProp,onUpdate:I},null,8,["index","item-index","tax-data","taxes","discounted-total","total-tax","total","currency","ability","store","store-prop"]))),128))])])):E("",!0)])])])])}}},Mt={class:"text-center item-table min-w-full"},Dt=n("col",{style:{width:"40%","min-width":"280px"}},null,-1),Vt=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),jt=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),qt={key:0,style:{width:"15%","min-width":"160px"}},Lt=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),Et={class:"bg-white border border-gray-200 border-solid"},Ot={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Nt={key:1,class:"pl-7"},Ut={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Ft={key:1},At={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},zt={key:1},Wt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Yt={key:1},Rt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Gt={key:1},Xt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Ht={key:1},Zt={key:0,class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Jt={key:1},Kt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Qt={key:1,class:"pr-10 column-heading"},Qo={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(e){const o=e,t=te(),h=w(()=>o.currency?o.currency:t.selectedCompanyCurrency);return($,v)=>{const B=x("BaseContentPlaceholdersText"),u=x("BaseContentPlaceholders"),M=x("BaseIcon");return r(),p(J,null,[n("table",Mt,[n("colgroup",null,[Dt,Vt,jt,e.store[e.storeProp].discount_per_item==="YES"?(r(),p("col",qt)):E("",!0),Lt]),n("thead",Et,[n("tr",null,[n("th",Ot,[e.isLoading?(r(),k(u,{key:0},{default:l(()=>[s(B,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",Nt,y($.$tc("items.item",2)),1))]),n("th",Ut,[e.isLoading?(r(),k(u,{key:0},{default:l(()=>[s(B,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",Ft,y($.$t("invoices.item.width")),1))]),n("th",At,[e.isLoading?(r(),k(u,{key:0},{default:l(()=>[s(B,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",zt,y($.$t("invoices.item.length")),1))]),n("th",Wt,[e.isLoading?(r(),k(u,{key:0},{default:l(()=>[s(B,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",Yt,y($.$t("invoices.item.quantity")),1))]),n("th",Rt,[e.isLoading?(r(),k(u,{key:0},{default:l(()=>[s(B,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",Gt,y($.$t("invoices.item.area")),1))]),n("th",Xt,[e.isLoading?(r(),k(u,{key:0},{default:l(()=>[s(B,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",Ht,y($.$t("invoices.item.price")),1))]),e.store[e.storeProp].discount_per_item==="YES"?(r(),p("th",Zt,[e.isLoading?(r(),k(u,{key:0},{default:l(()=>[s(B,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",Jt,y($.$t("invoices.item.discount")),1))])):E("",!0),n("th",Kt,[e.isLoading?(r(),k(u,{key:0},{default:l(()=>[s(B,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",Qt,y($.$t("invoices.item.amount")),1))])])]),s(a(Ve),{modelValue:e.store[e.storeProp].items,"onUpdate:modelValue":v[0]||(v[0]=C=>e.store[e.storeProp].items=C),"item-key":"id",tag:"tbody",handle:".handle"},{item:l(({element:C,index:T})=>[s(Ct,{key:C.id,index:T,"item-data":C,loading:e.isLoading,currency:a(h),"item-validation-scope":e.itemValidationScope,"invoice-items":e.store[e.storeProp].items,store:e.store,"store-prop":e.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"])]),_:1},8,["modelValue"])]),n("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:v[1]||(v[1]=(...C)=>e.store.addItem&&e.store.addItem(...C))},[s(M,{name:"PlusCircleIcon",class:"mr-2"}),U(" "+y($.$t("general.add_new_item")),1)])],64)}}},eo={class:"flex items-center justify-between w-full mt-2 text-sm"},to={class:"font-semibold leading-5 text-gray-500 uppercase"},oo={class:"flex items-center justify-center text-lg text-black"},no={props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},data:{type:String,default:""}},emits:["update","remove"],setup(e,{emit:o}){const t=e;ae("$utils");const h=w(()=>t.tax.compound_tax&&t.store.getSubtotalWithDiscount?Math.round((t.store.getSubtotalWithDiscount+t.store.getTotalSimpleTax)*t.tax.percent/100):t.store.getSubtotalWithDiscount&&t.tax.percent?Math.round(t.store.getSubtotalWithDiscount*t.tax.percent/100):0);Oe(()=>{t.store.getSubtotalWithDiscount&&$(),t.store.getTotalSimpleTax&&$()});function $(){o("update",W(N({},t.tax),{amount:h.value}))}return(v,B)=>{const u=x("BaseFormatMoney"),M=x("BaseIcon");return r(),p("div",eo,[n("label",to,y(e.tax.name)+" ("+y(e.tax.percent)+" %) ",1),n("label",oo,[s(u,{amount:e.tax.amount,currency:e.currency},null,8,["amount","currency"]),s(M,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:B[0]||(B[0]=C=>v.$emit("remove",e.tax.id))})])])}}},so={class:"w-full mt-4 tax-select"},ao={class:"relative w-full max-w-md px-4"},ro={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},io={class:"relative bg-white"},lo={class:"relative p-4"},co={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},uo=["onClick"],mo={class:"flex justify-between px-2"},po={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},yo={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},xo={key:1,class:"flex justify-center p-5 text-gray-400"},fo={class:"text-base text-gray-500 cursor-pointer"},ho={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},go={props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(e,{emit:o}){const t=e,h=ee(),$=se(),v=me(),{t:B}=oe(),u=X(null),M=w(()=>u.value?$.taxTypes.filter(function(S){return S.name.toLowerCase().indexOf(u.value.toLowerCase())!==-1}):$.taxTypes),C=w(()=>t.store[t.storeProp].taxes);function T(S,i){o("select:taxType",N({},S)),i()}function q(){h.openModal({title:B("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:S=>o("select:taxType",S)})}return(S,i)=>{const g=x("BaseIcon"),d=x("BaseInput");return r(),p("div",so,[s(a(Ae),{class:"relative"},{default:l(({isOpen:b})=>[s(a(Ne),{class:K([b?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:l(()=>[s(g,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),U(" "+y(S.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),n("div",ao,[s(Ue,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:l(()=>[s(a(Fe),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 transform -translate-x-full sm:px-0"},{default:l(({close:D})=>[n("div",ro,[n("div",io,[n("div",lo,[s(d,{modelValue:u.value,"onUpdate:modelValue":i[0]||(i[0]=f=>u.value=f),placeholder:S.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),a(M).length>0?(r(),p("div",co,[(r(!0),p(J,null,Q(a(M),(f,_)=>(r(),p("div",{key:_,class:K([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":a(C).find(I=>I.tax_type_id===f.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:I=>T(f,D)},[n("div",mo,[n("label",po,y(f.name),1),n("label",yo,y(f.percent)+" % ",1)])],10,uo))),128))])):(r(),p("div",xo,[n("label",fo,y(S.$t("general.no_tax_found")),1)]))]),a(v).hasAbilities(a(ye).CREATE_TAX_TYPE)?(r(),p("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:q},[s(g,{name:"CheckCircleIcon",class:"text-primary-400"}),n("label",ho,y(S.$t("estimates.add_new_tax")),1)])):E("",!0)])]),_:1})]),_:1})])]),_:1})])}}},bo={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},vo={class:"flex items-center justify-between w-full"},_o={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},$o={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},wo={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},Bo={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},Io={key:0,class:"flex items-center justify-between w-full mt-2"},Po={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},ko={key:3,class:"flex",style:{width:"140px"},role:"group"},So={class:"flex items-center"},To={key:1},Co={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},Mo={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},Do={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},en={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(e){const o=e,t=X(null);ae("$utils");const h=te(),$=w({get:()=>o.store[o.storeProp].discount,set:i=>{o.store[o.storeProp].discount_type==="percentage"?o.store[o.storeProp].discount_val=Math.round(o.store.getSubTotal*i/100):o.store[o.storeProp].discount_val=Math.round(i*100),o.store[o.storeProp].discount=i}}),v=w({get:()=>o.store[o.storeProp].taxes,set:i=>{o.store.$patch(g=>{g[o.storeProp].taxes=i})}}),B=w(()=>{let i=[];return o.store[o.storeProp].items.forEach(g=>{g.taxes&&g.taxes.forEach(d=>{let b=i.find(D=>D.tax_type_id===d.tax_type_id);b?b.amount+=d.amount:d.tax_type_id&&i.push({tax_type_id:d.tax_type_id,amount:d.amount,percent:d.percent,name:d.name})})}),i}),u=w(()=>o.currency?o.currency:h.selectedCompanyCurrency);function M(){o.store[o.storeProp].discount_type!=="fixed"&&(o.store[o.storeProp].discount_val=Math.round(o.store[o.storeProp].discount*100),o.store[o.storeProp].discount_type="fixed")}function C(){o.store[o.storeProp].discount_type!=="percentage"&&(o.store[o.storeProp].discount_val=o.store.getSubTotal*o.store[o.storeProp].discount/100,o.store[o.storeProp].discount_type="percentage")}function T(i){let g=0;i.compound_tax&&o.store.getSubtotalWithDiscount?g=Math.round((o.store.getSubtotalWithDiscount+o.store.getTotalSimpleTax)*i.percent/100):o.store.getSubtotalWithDiscount&&i.percent&&(g=Math.round(o.store.getSubtotalWithDiscount*i.percent/100));let d=W(N({},xe),{id:be.raw(),name:i.name,percent:i.percent,compound_tax:i.compound_tax,tax_type_id:i.id,amount:g});o.store.$patch(b=>{b[o.storeProp].taxes.push(N({},d))})}function q(i){const g=o.store[o.storeProp].taxes.find(d=>d.id===i.id);g&&Object.assign(g,N({},i))}function S(i){const g=o.store[o.storeProp].taxes.findIndex(d=>d.id===i);o.store.$patch(d=>{d[o.storeProp].taxes.splice(g,1)})}return(i,g)=>{const d=x("BaseContentPlaceholdersText"),b=x("BaseContentPlaceholders"),D=x("BaseFormatMoney"),f=x("BaseInput"),_=x("BaseIcon"),I=x("BaseButton"),G=x("BaseDropdownItem"),F=x("BaseDropdown");return r(),p("div",bo,[n("div",vo,[e.isLoading?(r(),k(b,{key:0},{default:l(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("label",_o,y(i.$t("estimates.sub_total")),1)),e.isLoading?(r(),k(b,{key:2},{default:l(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("label",$o,[s(D,{amount:e.store.getSubTotal,currency:a(u)},null,8,["amount","currency"])]))]),(r(!0),p(J,null,Q(a(B),L=>(r(),p("div",{key:L.tax_type_id,class:"flex items-center justify-between w-full"},[e.isLoading?(r(),k(b,{key:0},{default:l(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):e.store[e.storeProp].tax_per_item==="YES"?(r(),p("label",wo,y(L.name)+" - "+y(L.percent)+"% ",1)):E("",!0),e.isLoading?(r(),k(b,{key:2},{default:l(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):e.store[e.storeProp].tax_per_item==="YES"?(r(),p("label",Bo,[s(D,{amount:L.amount,currency:a(u)},null,8,["amount","currency"])])):E("",!0)]))),128)),e.store[e.storeProp].discount_per_item==="NO"||e.store[e.storeProp].discount_per_item===null?(r(),p("div",Io,[e.isLoading?(r(),k(b,{key:0},{default:l(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("label",Po,y(i.$t("estimates.discount")),1)),e.isLoading?(r(),k(b,{key:2},{default:l(()=>[s(d,{lines:1,class:"w-24 h-8 rounded-md border"})]),_:1})):(r(),p("div",ko,[s(f,{modelValue:a($),"onUpdate:modelValue":g[0]||(g[0]=L=>R($)?$.value=L:null),class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue"]),s(F,{position:"bottom-end"},{activator:l(()=>[s(I,{class:"rounded-tr-md rounded-br-md p-2 rounded-none",type:"button",variant:"white"},{default:l(()=>[n("span",So,[U(y(e.store[e.storeProp].discount_type=="fixed"?a(u).symbol:"%")+" ",1),s(_,{name:"ChevronDownIcon",class:"w-4 h-4 text-gray-500 ml-1"})])]),_:1})]),default:l(()=>[s(G,{onClick:M},{default:l(()=>[U(y(i.$t("general.fixed")),1)]),_:1}),s(G,{onClick:C},{default:l(()=>[U(y(i.$t("general.percentage")),1)]),_:1})]),_:1})]))])):E("",!0),e.store[e.storeProp].tax_per_item==="NO"||e.store[e.storeProp].tax_per_item===null?(r(),p("div",To,[(r(!0),p(J,null,Q(a(v),(L,Y)=>(r(),k(no,{key:L.id,index:Y,tax:L,taxes:a(v),currency:e.currency,store:e.store,onRemove:S,onUpdate:q},null,8,["index","tax","taxes","currency","store"]))),128))])):E("",!0),e.store[e.storeProp].tax_per_item==="NO"||e.store[e.storeProp].tax_per_item===null?(r(),p("div",{key:2,ref:(L,Y)=>{Y.taxModal=L,t.value=L},class:"float-right pt-2 pb-4"},[s(go,{"store-prop":e.storeProp,store:e.store,type:e.taxPopupType,"onSelect:taxType":T},null,8,["store-prop","store","type"])],512)):E("",!0),n("div",Co,[e.isLoading?(r(),k(b,{key:0},{default:l(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("label",Mo,y(i.$t("estimates.total"))+" "+y(i.$t("estimates.amount"))+":",1)),e.isLoading?(r(),k(b,{key:2},{default:l(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("label",Do,[s(D,{amount:e.store.getTotal,currency:a(u)},null,8,["amount","currency"])]))])])}}},Vo={class:"mb-6"},jo={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},qo={class:"text-primary-800 font-medium mb-4 text-sm"},tn={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Object,default:null},type:{type:String,default:null}},setup(e){const o=e;function t(h){o.store[o.storeProp].notes=""+h.notes}return(h,$)=>{const v=x("BaseCustomInput");return r(),p("div",Vo,[n("div",jo,[s(Re,{type:e.type,onSelect:t},null,8,["type"])]),n("label",qo,y(h.$t("invoices.notes")),1),s(v,{modelValue:e.store[e.storeProp].notes,"onUpdate:modelValue":$[0]||($[0]=B=>e.store[e.storeProp].notes=B),"content-loading":e.store.isFetchingInitialSettings,fields:e.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"])])}}};var Lo="/build/img/tick.png";const Eo={class:"flex justify-between w-full"},Oo={class:"px-8 py-8 sm:p-6"},No={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},Uo=["src","alt","onClick"],Fo=["alt"],Ao={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},on={setup(e){const o=ee(),t=X(""),h=w(()=>o.active&&o.componentName==="SelectTemplate"),$=w(()=>o.title);function v(){o.data.store[o.data.storeProp].template_name?t.value=o.data.store[o.data.storeProp].template_name:t.value=o.data.templates[0]}async function B(){await o.data.store.setTemplate(t.value),u()}function u(){o.closeModal(),setTimeout(()=>{o.$reset()},300)}return(M,C)=>{const T=x("BaseIcon"),q=x("BaseButton"),S=x("BaseModal");return r(),k(S,{show:a(h),onClose:u,onOpen:v},{header:l(()=>[n("div",Eo,[U(y(a($))+" ",1),s(T,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:u})])]),default:l(()=>[n("div",Oo,[a(o).data?(r(),p("div",No,[(r(!0),p(J,null,Q(a(o).data.templates,(i,g)=>(r(),p("div",{key:g,class:K([{"border border-solid border-primary-500":t.value===i.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"])},[n("img",{src:i.path,alt:i.name,class:"w-full",onClick:d=>t.value=i.name},null,8,Uo),t.value===i.name?(r(),p("img",{key:0,alt:i.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:Lo},null,8,Fo)):E("",!0),n("span",{class:K(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":t.value===i.name,"text-gray-600":t.value!=i.name}])},y(i.name),3)],2))),128))])):E("",!0)]),n("div",Ao,[s(q,{class:"mr-3",variant:"primary-outline",onClick:u},{default:l(()=>[U(y(M.$t("general.cancel")),1)]),_:1}),s(q,{variant:"primary",onClick:C[0]||(C[0]=i=>B())},{left:l(i=>[s(T,{name:"SaveIcon",class:K(i.class)},null,8,["class"])]),default:l(()=>[U(" "+y(M.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},zo={class:"flex justify-between w-full"},Wo={class:"item-modal"},Yo=["onSubmit"],Ro={class:"px-8 py-8 sm:p-6"},Go={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},nn={emits:["newItem"],setup(e,{emit:o}){const t=ee(),h=pe(),$=te(),v=se();Ce(),Me();const{t:B}=oe(),u=X(!1),M=X($.selectedCompanySettings.tax_per_item),C=w(()=>t.active&&t.componentName==="ItemModal"),T=w({get:()=>h.currentItem.price/100,set:f=>{h.currentItem.price=Math.round(f*100)}}),q=w({get:()=>h.currentItem.taxes.map(f=>{if(f)return W(N({},f),{tax_type_id:f.id,tax_name:f.name+" ("+f.percent+"%)"})}),set:f=>{h.$patch(_=>{_.currentItem.taxes=f})}}),S=w(()=>M.value==="YES"),i={name:{required:j.withMessage(B("validation.required"),H),minLength:j.withMessage(B("validation.name_min_length",{count:3}),ze(3))},description:{maxLength:j.withMessage(B("validation.description_maxlength",{count:255}),Z(255))}},g=ge(i,w(()=>h.currentItem)),d=w(()=>v.taxTypes.map(f=>W(N({},f),{tax_name:f.name+" ("+f.percent+"%)"})));We(()=>{g.value.$reset(),h.fetchItemUnits({limit:"all"})});async function b(){if(g.value.$touch(),g.value.$invalid)return!0;let f=W(N({},h.currentItem),{taxes:h.currentItem.taxes.map(I=>({tax_type_id:I.id,amount:T.value*I.percent/100,percent:I.percent,name:I.name,collective_tax:0}))});u.value=!0,await(h.isEdit?h.updateItem:h.addItem)(f).then(I=>{u.value=!1,I.data.data&&t.data&&t.refreshData(I.data.data),D()})}function D(){t.closeModal(),setTimeout(()=>{h.resetCurrentItem(),t.$reset(),g.value.$reset()},300)}return(f,_)=>{const I=x("BaseIcon"),G=x("BaseInput"),F=x("BaseInputGroup"),L=x("BaseMoney"),Y=x("BaseMultiselect"),A=x("BaseTextarea"),O=x("BaseInputGrid"),c=x("BaseButton"),m=x("BaseModal");return r(),k(m,{show:a(C),onClose:D},{header:l(()=>[n("div",zo,[U(y(a(t).title)+" ",1),s(I,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:D})])]),default:l(()=>[n("div",Wo,[n("form",{action:"",onSubmit:Ye(b,["prevent"])},[n("div",Ro,[s(O,{layout:"one-column"},{default:l(()=>[s(F,{label:f.$t("items.name"),required:"",error:a(g).name.$error&&a(g).name.$errors[0].$message},{default:l(()=>[s(G,{modelValue:a(h).currentItem.name,"onUpdate:modelValue":_[0]||(_[0]=P=>a(h).currentItem.name=P),type:"text",invalid:a(g).name.$error,onInput:_[1]||(_[1]=P=>a(g).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),s(F,{label:f.$t("items.price")},{default:l(()=>[s(L,{key:a($).selectedCompanyCurrency,modelValue:a(T),"onUpdate:modelValue":_[2]||(_[2]=P=>R(T)?T.value=P:null),currency:a($).selectedCompanyCurrency,class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency"])]),_:1},8,["label"]),s(F,{label:f.$t("items.unit")},{default:l(()=>[s(Y,{modelValue:a(h).currentItem.unit_id,"onUpdate:modelValue":_[3]||(_[3]=P=>a(h).currentItem.unit_id=P),label:"name",options:a(h).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:f.$t("items.select_a_unit"),searchable:"","track-by":"id"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),a(S)?(r(),k(F,{key:0,label:f.$t("items.taxes")},{default:l(()=>[s(Y,{modelValue:a(q),"onUpdate:modelValue":_[4]||(_[4]=P=>R(q)?q.value=P:null),options:a(d),label:"name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"id",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):E("",!0),s(F,{label:f.$t("items.description"),error:a(g).description.$error&&a(g).description.$errors[0].$message},{default:l(()=>[s(A,{modelValue:a(h).currentItem.description,"onUpdate:modelValue":_[5]||(_[5]=P=>a(h).currentItem.description=P),rows:"4",cols:"50",invalid:a(g).description.$error,onInput:_[6]||(_[6]=P=>a(g).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),n("div",Go,[s(c,{class:"mr-3",variant:"primary-outline",type:"button",onClick:D},{default:l(()=>[U(y(f.$t("general.cancel")),1)]),_:1}),s(c,{loading:u.value,disabled:u.value,variant:"primary",type:"submit"},{left:l(P=>[s(I,{name:"SaveIcon",class:K(P.class)},null,8,["class"])]),default:l(()=>[U(" "+y(a(h).isEdit?f.$t("general.update"):f.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],40,Yo)])]),_:1},8,["show"])}}};export{on as _,nn as a,Qo as b,tn as c,en as d};
