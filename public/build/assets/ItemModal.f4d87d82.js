var Ie=Object.defineProperty,Pe=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var ue=(e,o,t)=>o in e?Ie(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,U=(e,o)=>{for(var t in o||(o={}))ke.call(o,t)&&ue(e,t,o[t]);if(ce)for(var t of ce(o))Te.call(o,t)&&ue(e,t,o[t]);return e},W=(e,o)=>Pe(e,Se(o));import{q as se,g as Q,d as me,c as oe,p as pe,e as ye,T as xe,j as Ce,u as Me}from"./main.54d0696d.js";import{D as De,d as Ve}from"./DragIcon.e6a4f599.js";import{i as H,j as je,am as ae,g as ee,k as B,D as fe,r as x,o as r,c as p,t as n,x as y,b as s,a5 as qe,y as a,w as i,v as q,s as S,A as O,u as Le,l as ge,m as j,n as Z,b4 as ne,a4 as J,aZ as Ee,q as he,a0 as R,F as K,H as te,G as be,ac as Oe,a6 as Ne,z as G,T as Ue,a7 as Fe,a8 as Ae,p as ze,M as We,B as Ye}from"./vendor.060aaec3.js";import{_ as Re}from"./SelectNotePopup.d44cea48.js";const Ge={class:"flex items-center justify-between mb-3"},Xe={class:"flex items-center text-base",style:{flex:"4"}},He={class:"pr-2 mb-0",align:"right"},Ze={class:"absolute left-3.5"},Je={class:"ml-2 text-sm leading-none text-primary-400 cursor-pointer"},Ke=n("br",null,null,-1),Qe={class:"text-sm text-right",style:{flex:"3"}},et={class:"flex items-center justify-center w-6 h-10 mx-2 cursor-pointer"},tt={props:{ability:{type:String,default:""},store:{type:Object,default:null},storeProp:{type:String,default:""},itemIndex:{type:Number,required:!0},index:{type:Number,required:!0},taxData:{type:Object,required:!0},taxes:{type:Array,default:[]},total:{type:Number,default:0},totalTax:{type:Number,default:0},currency:{type:[Object,String],required:!0},updateItems:{type:Function,default:()=>{}}},emits:["remove","update"],setup(e,{emit:o}){const t=e,f=se(),v=Q(),b=me(),w=H(null),u=je(U({},t.taxData));ae("utils");const{t:M}=ee(),T=B(()=>f.taxTypes.map(_=>U({},_)).map(_=>(t.taxes.find(g=>g.tax_type_id===_.id)?_.disabled=!0:_.disabled=!1,_))),C=B(()=>u.compound_tax&&t.total?(t.total+t.totalTax)*u.percent/100:t.total&&u.percent?t.total*u.percent/100:0);fe(()=>t.total,()=>{k()}),fe(()=>t.totalTax,()=>{k()}),t.taxData.tax_type_id>0&&(w.value=f.taxTypes.find(d=>d.id===t.taxData.tax_type_id)),k();function L(d){u.percent=d.percent,u.tax_type_id=d.id,u.compound_tax=d.compound_tax,u.name=d.name,k()}function k(){u.tax_type_id!==0&&o("update",{index:t.index,item:W(U({},u),{amount:C.value})})}function l(){let d={itemIndex:t.itemIndex,taxIndex:t.index};v.openModal({title:M("settings.tax_types.add_tax"),componentName:"TaxTypeModal",data:d,size:"sm"})}function h(d){t.store.$patch(_=>{_[t.storeProp].items[t.itemIndex].taxes.splice(d,1)})}return(d,_)=>{const D=x("BaseIcon"),g=x("BaseMultiselect"),$=x("BaseFormatMoney");return r(),p("div",Ge,[n("div",Xe,[n("label",He,y(d.$t("invoices.item.tax")),1),s(g,{modelValue:w.value,"onUpdate:modelValue":[_[0]||(_[0]=I=>w.value=I),_[1]||(_[1]=I=>L(I))],"value-prop":"id",options:a(T),placeholder:d.$t("general.select_a_tax"),"open-direction":"top","track-by":"name",searchable:"",object:"",label:"name"},qe({singlelabel:i(({value:I})=>[n("div",Ze,y(I.name)+" - "+y(I.percent)+" % ",1)]),option:i(({option:I})=>[q(y(I.name)+" - "+y(I.percent)+" % ",1)]),_:2},[a(b).hasAbilities(e.ability)?{name:"action",fn:i(()=>[n("button",{type:"button",class:"flex items-center justify-center w-full px-2 cursor-pointer py-2 bg-gray-200 border-none outline-none",onClick:l},[s(D,{name:"CheckCircleIcon",class:"h-5 text-primary-400"}),n("label",Je,y(d.$t("invoices.add_new_tax")),1)])])}:void 0]),1032,["modelValue","options","placeholder"]),Ke]),n("div",Qe,[s($,{amount:a(C),currency:e.currency},null,8,["amount","currency"])]),n("div",et,[e.taxes.length&&e.index!==e.taxes.length-1?(r(),S(D,{key:0,name:"TrashIcon",class:"h-5 text-gray-700 cursor-pointer",onClick:_[2]||(_[2]=I=>h(e.index))})):O("",!0)])])}}},ot={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},nt={colspan:"8",class:"p-0 text-left align-top"},st={class:"w-full"},at=n("col",{style:{width:"25%","min-width":"280px"}},null,-1),rt=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),lt=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),it={key:0,style:{width:"15%","min-width":"160px"}},dt=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),ct={class:"px-5 py-4 text-left align-top"},ut={class:"flex justify-start"},mt={class:"flex items-center justify-center w-5 h-5 mt-2 text-gray-300 cursor-move handle mr-2"},pt={class:"px-5 py-4 text-right align-top"},yt={class:"px-5 py-4 text-right align-top"},xt={class:"px-5 py-4 text-right align-top"},ft={class:"px-5 py-4 text-left align-top"},gt={class:"flex flex-col"},ht={class:"flex-auto flex-fill bd-highlight"},bt={style:{"min-width":"150px"},class:"relative w-full"},_t={key:0,class:"px-5 py-4 text-left align-top"},vt={class:"flex flex-col"},$t={class:"flex",style:{width:"120px"},role:"group"},wt={class:"flex items-center"},Bt={class:"px-5 py-4 text-right align-top"},It={style:{"min-width":"200px"},class:"flex items-center justify-end text-sm"},Pt={class:"flex items-center justify-center w-6 h-10 mx-2"},St={key:0},kt=n("td",{class:"px-5 py-4 text-left align-top"},null,-1),Tt={colspan:"4",class:"px-5 py-4 text-left align-top"},Ct={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(e,{emit:o}){const t=e,f=oe(),v=pe();Le();const{t:b}=ee(),w=B({get:()=>t.itemData.quantity,set:c=>{N("quantity",parseFloat(c))}}),u=B({get:()=>t.itemData.width,set:c=>{N("width",parseFloat(c))}}),M=B({get:()=>t.itemData.length,set:c=>{N("length",parseFloat(c))}}),T=B({get:()=>{const c=t.itemData.price;return parseFloat(c)>0?c/100:c},set:c=>{if(parseFloat(c)>0){let m=Math.round(c*100);N("price",m)}else N("price",c)}}),C=B(()=>t.itemData.price*t.itemData.quantity*t.itemData.width*t.itemData.length),L=B({get:()=>t.itemData.discount,set:c=>{t.itemData.discount_type==="percentage"?N("discount_val",C.value*c/100):N("discount_val",Math.round(c*100)),N("discount",c)}}),k=B(()=>C.value-t.itemData.discount_val),l=B(()=>t.currency?t.currency:f.selectedCompanyCurrency),h=B(()=>t.store[t.storeProp].items.length!=1),d=B(()=>Math.round(ge.exports.sumBy(t.itemData.taxes,function(c){return c.compound_tax?0:c.amount}))),_=B(()=>Math.round(ge.exports.sumBy(t.itemData.taxes,function(c){return c.compound_tax?c.amount:0}))),D=B(()=>d.value+_.value),g={name:{required:j.withMessage(b("validation.required"),Z)},quantity:{required:j.withMessage(b("validation.required"),Z),minValue:j.withMessage(b("validation.qty_must_greater_than_zero"),ne(0)),maxLength:j.withMessage(b("validation.amount_maxlength"),J(20))},width:{required:j.withMessage(b("validation.required"),Z),minValue:j.withMessage(b("validation.qty_must_greater_than_zero"),ne(0)),maxLength:j.withMessage(b("validation.amount_maxlength"),J(20))},length:{required:j.withMessage(b("validation.required"),Z),minValue:j.withMessage(b("validation.qty_must_greater_than_zero"),ne(0)),maxLength:j.withMessage(b("validation.amount_maxlength"),J(20))},price:{required:j.withMessage(b("validation.required"),Z),minValue:j.withMessage(b("validation.number_length_minvalue"),ne(1)),maxLength:j.withMessage(b("validation.price_maxlength"),J(20))},discount_val:{between:j.withMessage(b("validation.discount_maxlength"),Ee(0,B(()=>C.value)))},description:{maxLength:j.withMessage(b("validation.notes_maxlength"),J(65e3))}},$=he(g,B(()=>t.store[t.storeProp].items[t.index]),{$scope:t.itemValidationScope});function I(c){t.store.$patch(P=>{P[t.storeProp].items[t.index].taxes[c.index]=c.item});let m=t.itemData.taxes[t.itemData.taxes.length-1];(m==null?void 0:m.tax_type_id)!==0&&t.store.$patch(P=>{P[t.storeProp].items[t.index].taxes.push(W(U({},xe),{id:be.raw()}))}),A()}function X(c){N("name",c)}function F(c){t.store.$patch(m=>{if(m[t.storeProp].items[t.index].name=c.name,m[t.storeProp].items[t.index].price=c.price,m[t.storeProp].items[t.index].item_id=c.id,m[t.storeProp].items[t.index].description=c.description,c.unit&&(m[t.storeProp].items[t.index].unit_name=c.unit.name),t.store[t.storeProp].tax_per_item==="YES"&&c.taxes){let P=0;c.taxes.forEach(z=>{I({index:P,item:U({},z)}),P++})}m[t.storeProp].exchange_rate&&(m[t.storeProp].items[t.index].price/=m[t.storeProp].exchange_rate)}),v.fetchItems(),A()}function E(){t.itemData.discount_type!=="fixed"&&(N("discount_val",Math.round(t.itemData.discount*100)),N("discount_type","fixed"))}function Y(){t.itemData.discount_type!=="percentage"&&(N("discount_val",C.value*t.itemData.discount/100),N("discount_type","percentage"))}function A(){var P,z;let c=(z=(P=t.store[t.storeProp])==null?void 0:P.items[t.index])==null?void 0:z.taxes;c||(c=[]);let m=W(U({},t.store[t.storeProp].items[t.index]),{index:t.index,total:k.value,sub_total:C.value,totalSimpleTax:d.value,totalCompoundTax:_.value,totalTax:D.value,tax:D.value,taxes:[...c]});t.store.updateItem(m)}function N(c,m){t.store.$patch(P=>{P[t.storeProp].items[t.index][c]=m}),A()}return(c,m)=>{const P=x("BaseItemSelect"),z=x("BaseInput"),_e=x("BaseMoney"),re=x("BaseIcon"),ve=x("BaseButton"),le=x("BaseDropdownItem"),$e=x("BaseDropdown"),ie=x("BaseContentPlaceholdersText"),de=x("BaseContentPlaceholders"),we=x("BaseFormatMoney");return r(),p("tr",ot,[n("td",nt,[n("table",st,[n("colgroup",null,[at,rt,lt,e.store[e.storeProp].discount_per_item==="YES"?(r(),p("col",it)):O("",!0),dt]),n("tbody",null,[n("tr",null,[n("td",ct,[n("div",ut,[n("div",mt,[s(De)]),s(P,{type:"Invoice",item:e.itemData,invalid:a($).name.$error,"invalid-description":a($).description.$error,taxes:e.itemData.taxes,index:e.index,"store-prop":e.storeProp,store:e.store,onSearch:X,onSelect:F},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),n("td",pt,[s(z,{modelValue:a(u),"onUpdate:modelValue":m[0]||(m[0]=V=>R(u)?u.value=V:null),invalid:a($).width.$error,"content-loading":e.loading,type:"number",small:"",min:"0",step:"any",onChange:m[1]||(m[1]=V=>A()),onInput:m[2]||(m[2]=V=>a($).width.$touch())},null,8,["modelValue","invalid","content-loading"])]),n("td",yt,[s(z,{modelValue:a(M),"onUpdate:modelValue":m[3]||(m[3]=V=>R(M)?M.value=V:null),invalid:a($).length.$error,"content-loading":e.loading,type:"number",small:"",min:"0",step:"any",onChange:m[4]||(m[4]=V=>A()),onInput:m[5]||(m[5]=V=>a($).length.$touch())},null,8,["modelValue","invalid","content-loading"])]),n("td",xt,[s(z,{modelValue:a(w),"onUpdate:modelValue":m[6]||(m[6]=V=>R(w)?w.value=V:null),invalid:a($).quantity.$error,"content-loading":e.loading,type:"number",small:"",min:"0",step:"any",onChange:m[7]||(m[7]=V=>A()),onInput:m[8]||(m[8]=V=>a($).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),n("td",ft,[n("div",gt,[n("div",ht,[n("div",bt,[s(_e,{key:a(l),modelValue:a(T),"onUpdate:modelValue":m[9]||(m[9]=V=>R(T)?T.value=V:null),invalid:a($).price.$error,"content-loading":e.loading,currency:a(l)},null,8,["modelValue","invalid","content-loading","currency"])])])])]),e.store[e.storeProp].discount_per_item==="YES"?(r(),p("td",_t,[n("div",vt,[n("div",$t,[s(z,{modelValue:a(L),"onUpdate:modelValue":m[10]||(m[10]=V=>R(L)?L.value=V:null),invalid:a($).discount_val.$error,"content-loading":e.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"]),s($e,{position:"bottom-end"},{activator:i(()=>[s(ve,{"content-loading":e.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:i(()=>[n("span",wt,[q(y(e.itemData.discount_type=="fixed"?e.currency.symbol:"%")+" ",1),s(re,{name:"ChevronDownIcon",class:"w-4 h-4 text-gray-500 ml-1"})])]),_:1},8,["content-loading"])]),default:i(()=>[s(le,{onClick:E},{default:i(()=>[q(y(c.$t("general.fixed")),1)]),_:1}),s(le,{onClick:Y},{default:i(()=>[q(y(c.$t("general.percentage")),1)]),_:1})]),_:1})])])])):O("",!0),n("td",Bt,[n("div",It,[n("span",null,[e.loading?(r(),S(de,{key:0},{default:i(()=>[s(ie,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),S(we,{key:1,amount:a(k),currency:a(l)},null,8,["amount","currency"]))]),n("div",Pt,[a(h)?(r(),S(re,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:m[11]||(m[11]=V=>e.store.removeItem(e.index))})):O("",!0)])])])]),e.store[e.storeProp].tax_per_item==="YES"?(r(),p("tr",St,[kt,n("td",Tt,[e.loading?(r(),S(de,{key:0},{default:i(()=>[s(ie,{lines:1,class:"w-24 h-8 rounded-md border"})]),_:1})):(r(!0),p(K,{key:1},te(e.itemData.taxes,(V,Be)=>(r(),S(tt,{key:V.id,index:Be,"item-index":e.index,"tax-data":V,taxes:e.itemData.taxes,"discounted-total":a(k),"total-tax":a(d),total:a(C),currency:e.currency,"update-items":A,ability:a(ye).CREATE_INVOICE,store:e.store,"store-prop":e.storeProp,onUpdate:I},null,8,["index","item-index","tax-data","taxes","discounted-total","total-tax","total","currency","ability","store","store-prop"]))),128))])])):O("",!0)])])])])}}},Mt={class:"text-center item-table min-w-full"},Dt=n("col",{style:{width:"40%","min-width":"280px"}},null,-1),Vt=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),jt=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),qt={key:0,style:{width:"15%","min-width":"160px"}},Lt=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),Et={class:"bg-white border border-gray-200 border-solid"},Ot={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Nt={key:1,class:"pl-7"},Ut={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Ft={key:1},At={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},zt={key:1},Wt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Yt={key:1},Rt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Gt={key:1},Xt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Ht={key:1},Zt={key:0,class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Jt={key:1},Kt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Qt={key:1,class:"pr-10 column-heading"},tn={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(e){const o=e,t=oe(),f=B(()=>o.currency?o.currency:t.selectedCompanyCurrency);return(v,b)=>{const w=x("BaseContentPlaceholdersText"),u=x("BaseContentPlaceholders"),M=x("BaseIcon");return r(),p(K,null,[n("table",Mt,[n("colgroup",null,[Dt,Vt,jt,e.store[e.storeProp].discount_per_item==="YES"?(r(),p("col",qt)):O("",!0),Lt]),n("thead",Et,[n("tr",null,[n("th",Ot,[e.isLoading?(r(),S(u,{key:0},{default:i(()=>[s(w,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",Nt,y(v.$tc("items.item",2)),1))]),n("th",Ut,[e.isLoading?(r(),S(u,{key:0},{default:i(()=>[s(w,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",Ft,y(v.$t("invoices.item.width")),1))]),n("th",At,[e.isLoading?(r(),S(u,{key:0},{default:i(()=>[s(w,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",zt,y(v.$t("invoices.item.length")),1))]),n("th",Wt,[e.isLoading?(r(),S(u,{key:0},{default:i(()=>[s(w,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",Yt,y(v.$t("invoices.item.quantity")),1))]),n("th",Rt,[e.isLoading?(r(),S(u,{key:0},{default:i(()=>[s(w,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",Gt,y(v.$t("invoices.item.area")),1))]),n("th",Xt,[e.isLoading?(r(),S(u,{key:0},{default:i(()=>[s(w,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",Ht,y(v.$t("invoices.item.price")),1))]),e.store[e.storeProp].discount_per_item==="YES"?(r(),p("th",Zt,[e.isLoading?(r(),S(u,{key:0},{default:i(()=>[s(w,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",Jt,y(v.$t("invoices.item.discount")),1))])):O("",!0),n("th",Kt,[e.isLoading?(r(),S(u,{key:0},{default:i(()=>[s(w,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("span",Qt,y(v.$t("invoices.item.amount")),1))])])]),s(a(Ve),{modelValue:e.store[e.storeProp].items,"onUpdate:modelValue":b[0]||(b[0]=T=>e.store[e.storeProp].items=T),"item-key":"id",tag:"tbody",handle:".handle"},{item:i(({element:T,index:C})=>[s(Ct,{key:T.id,index:C,"item-data":T,loading:e.isLoading,currency:a(f),"item-validation-scope":e.itemValidationScope,"invoice-items":e.store[e.storeProp].items,store:e.store,"store-prop":e.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"])]),_:1},8,["modelValue"])]),n("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:b[1]||(b[1]=(...T)=>e.store.addItem&&e.store.addItem(...T))},[s(M,{name:"PlusCircleIcon",class:"mr-2"}),q(" "+y(v.$t("general.add_new_item")),1)])],64)}}},eo={class:"flex items-center justify-between w-full mt-2 text-sm"},to={class:"font-semibold leading-5 text-gray-500 uppercase"},oo={class:"flex items-center justify-center text-lg text-black"},no={props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},data:{type:String,default:""}},emits:["update","remove"],setup(e,{emit:o}){const t=e;ae("$utils");const f=B(()=>t.tax.compound_tax&&t.store.getSubtotalWithDiscount?Math.round((t.store.getSubtotalWithDiscount+t.store.getTotalSimpleTax)*t.tax.percent/100):t.store.getSubtotalWithDiscount&&t.tax.percent?Math.round(t.store.getSubtotalWithDiscount*t.tax.percent/100):0);Oe(()=>{t.store.getSubtotalWithDiscount&&v(),t.store.getTotalSimpleTax&&v()});function v(){o("update",W(U({},t.tax),{amount:f.value}))}return(b,w)=>{const u=x("BaseFormatMoney"),M=x("BaseIcon");return r(),p("div",eo,[n("label",to,y(e.tax.name)+" ("+y(e.tax.percent)+" %) ",1),n("label",oo,[s(u,{amount:e.tax.amount,currency:e.currency},null,8,["amount","currency"]),s(M,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:w[0]||(w[0]=T=>b.$emit("remove",e.tax.id))})])])}}},so={class:"w-full mt-4 tax-select"},ao={class:"relative w-full max-w-md px-4"},ro={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},lo={class:"relative bg-white"},io={class:"relative p-4"},co={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},uo=["onClick"],mo={class:"flex justify-between px-2"},po={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},yo={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},xo={key:1,class:"flex justify-center p-5 text-gray-400"},fo={class:"text-base text-gray-500 cursor-pointer"},go={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},ho={props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(e,{emit:o}){const t=e,f=Q(),v=se(),b=me(),{t:w}=ee(),u=H(null),M=B(()=>u.value?v.taxTypes.filter(function(k){return k.name.toLowerCase().indexOf(u.value.toLowerCase())!==-1}):v.taxTypes),T=B(()=>t.store[t.storeProp].taxes);function C(k,l){o("select:taxType",U({},k)),l()}function L(){f.openModal({title:w("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:k=>o("select:taxType",k)})}return(k,l)=>{const h=x("BaseIcon"),d=x("BaseInput");return r(),p("div",so,[s(a(Ae),{class:"relative"},{default:i(({isOpen:_})=>[s(a(Ne),{class:G([_?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:i(()=>[s(h,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),q(" "+y(k.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),n("div",ao,[s(Ue,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:i(()=>[s(a(Fe),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 transform -translate-x-full sm:px-0"},{default:i(({close:D})=>[n("div",ro,[n("div",lo,[n("div",io,[s(d,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=g=>u.value=g),placeholder:k.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),a(M).length>0?(r(),p("div",co,[(r(!0),p(K,null,te(a(M),(g,$)=>(r(),p("div",{key:$,class:G([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":a(T).find(I=>I.tax_type_id===g.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:I=>C(g,D)},[n("div",mo,[n("label",po,y(g.name),1),n("label",yo,y(g.percent)+" % ",1)])],10,uo))),128))])):(r(),p("div",xo,[n("label",fo,y(k.$t("general.no_tax_found")),1)]))]),a(b).hasAbilities(a(ye).CREATE_TAX_TYPE)?(r(),p("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:L},[s(h,{name:"CheckCircleIcon",class:"text-primary-400"}),n("label",go,y(k.$t("estimates.add_new_tax")),1)])):O("",!0)])]),_:1})]),_:1})])]),_:1})])}}},bo={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},_o={class:"flex items-center justify-between w-full"},vo={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},$o={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},wo={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},Bo={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},Io={key:0,class:"flex items-center justify-between w-full mt-2"},Po={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},So={key:3,class:"flex",style:{width:"140px"},role:"group"},ko={class:"flex items-center"},To={key:1},Co={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},Mo={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},Do={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},on={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(e){const o=e,t=H(null);ae("$utils");const f=oe(),v=B({get:()=>o.store[o.storeProp].discount,set:l=>{o.store[o.storeProp].discount_type==="percentage"?o.store[o.storeProp].discount_val=Math.round(o.store.getSubTotal*l/100):o.store[o.storeProp].discount_val=Math.round(l*100),o.store[o.storeProp].discount=l}}),b=B({get:()=>o.store[o.storeProp].taxes,set:l=>{o.store.$patch(h=>{h[o.storeProp].taxes=l})}}),w=B(()=>{let l=[];return o.store[o.storeProp].items.forEach(h=>{h.taxes&&h.taxes.forEach(d=>{let _=l.find(D=>D.tax_type_id===d.tax_type_id);_?_.amount+=d.amount:d.tax_type_id&&l.push({tax_type_id:d.tax_type_id,amount:d.amount,percent:d.percent,name:d.name})})}),l}),u=B(()=>o.currency?o.currency:f.selectedCompanyCurrency);function M(){o.store[o.storeProp].discount_type!=="fixed"&&(o.store[o.storeProp].discount_val=Math.round(o.store[o.storeProp].discount*100),o.store[o.storeProp].discount_type="fixed")}function T(){o.store[o.storeProp].discount_type!=="percentage"&&(o.store[o.storeProp].discount_val=o.store.getSubTotal*o.store[o.storeProp].discount/100,o.store[o.storeProp].discount_type="percentage")}function C(l){let h=0;l.compound_tax&&o.store.getSubtotalWithDiscount?h=Math.round((o.store.getSubtotalWithDiscount+o.store.getTotalSimpleTax)*l.percent/100):o.store.getSubtotalWithDiscount&&l.percent&&(h=Math.round(o.store.getSubtotalWithDiscount*l.percent/100));let d=W(U({},xe),{id:be.raw(),name:l.name,percent:l.percent,compound_tax:l.compound_tax,tax_type_id:l.id,amount:h});o.store.$patch(_=>{_[o.storeProp].taxes.push(U({},d))})}function L(l){const h=o.store[o.storeProp].taxes.find(d=>d.id===l.id);h&&Object.assign(h,U({},l))}function k(l){const h=o.store[o.storeProp].taxes.findIndex(d=>d.id===l);o.store.$patch(d=>{d[o.storeProp].taxes.splice(h,1)})}return(l,h)=>{const d=x("BaseContentPlaceholdersText"),_=x("BaseContentPlaceholders"),D=x("BaseFormatMoney"),g=x("BaseInput"),$=x("BaseIcon"),I=x("BaseButton"),X=x("BaseDropdownItem"),F=x("BaseDropdown");return r(),p("div",bo,[n("div",_o,[e.isLoading?(r(),S(_,{key:0},{default:i(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("label",vo,y(l.$t("estimates.sub_total")),1)),e.isLoading?(r(),S(_,{key:2},{default:i(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("label",$o,[s(D,{amount:e.store.getSubTotal,currency:a(u)},null,8,["amount","currency"])]))]),(r(!0),p(K,null,te(a(w),E=>(r(),p("div",{key:E.tax_type_id,class:"flex items-center justify-between w-full"},[e.isLoading?(r(),S(_,{key:0},{default:i(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):e.store[e.storeProp].tax_per_item==="YES"?(r(),p("label",wo,y(E.name)+" - "+y(E.percent)+"% ",1)):O("",!0),e.isLoading?(r(),S(_,{key:2},{default:i(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):e.store[e.storeProp].tax_per_item==="YES"?(r(),p("label",Bo,[s(D,{amount:E.amount,currency:a(u)},null,8,["amount","currency"])])):O("",!0)]))),128)),e.store[e.storeProp].discount_per_item==="NO"||e.store[e.storeProp].discount_per_item===null?(r(),p("div",Io,[e.isLoading?(r(),S(_,{key:0},{default:i(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("label",Po,y(l.$t("estimates.discount")),1)),e.isLoading?(r(),S(_,{key:2},{default:i(()=>[s(d,{lines:1,class:"w-24 h-8 rounded-md border"})]),_:1})):(r(),p("div",So,[s(g,{modelValue:a(v),"onUpdate:modelValue":h[0]||(h[0]=E=>R(v)?v.value=E:null),class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue"]),s(F,{position:"bottom-end"},{activator:i(()=>[s(I,{class:"rounded-tr-md rounded-br-md p-2 rounded-none",type:"button",variant:"white"},{default:i(()=>[n("span",ko,[q(y(e.store[e.storeProp].discount_type=="fixed"?a(u).symbol:"%")+" ",1),s($,{name:"ChevronDownIcon",class:"w-4 h-4 text-gray-500 ml-1"})])]),_:1})]),default:i(()=>[s(X,{onClick:M},{default:i(()=>[q(y(l.$t("general.fixed")),1)]),_:1}),s(X,{onClick:T},{default:i(()=>[q(y(l.$t("general.percentage")),1)]),_:1})]),_:1})]))])):O("",!0),e.store[e.storeProp].tax_per_item==="NO"||e.store[e.storeProp].tax_per_item===null?(r(),p("div",To,[(r(!0),p(K,null,te(a(b),(E,Y)=>(r(),S(no,{key:E.id,index:Y,tax:E,taxes:a(b),currency:e.currency,store:e.store,onRemove:k,onUpdate:L},null,8,["index","tax","taxes","currency","store"]))),128))])):O("",!0),e.store[e.storeProp].tax_per_item==="NO"||e.store[e.storeProp].tax_per_item===null?(r(),p("div",{key:2,ref:(E,Y)=>{Y.taxModal=E,t.value=E},class:"float-right pt-2 pb-4"},[s(ho,{"store-prop":e.storeProp,store:e.store,type:e.taxPopupType,"onSelect:taxType":C},null,8,["store-prop","store","type"])],512)):O("",!0),n("div",Co,[e.isLoading?(r(),S(_,{key:0},{default:i(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("label",Mo,y(l.$t("estimates.total"))+" "+y(l.$t("estimates.amount"))+":",1)),e.isLoading?(r(),S(_,{key:2},{default:i(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),p("label",Do,[s(D,{amount:e.store.getTotal,currency:a(u)},null,8,["amount","currency"])]))])])}}},Vo={class:"flex text-primary-800 font-medium text-sm mb-2"},jo=n("span",{class:"text-sm text-red-500"}," *",-1),nn={props:{store:{type:Object,default:null},storeProp:{type:String,default:""}},setup(e){const o=e,t=Q(),{t:f}=ee();function v(){t.openModal({title:f("general.choose_template"),componentName:"SelectTemplate",data:{templates:o.store.templates,store:o.store,storeProp:o.storeProp}})}return(b,w)=>{const u=x("BaseIcon"),M=x("BaseButton");return r(),p("div",null,[n("label",Vo,[q(y(b.$t("general.select_template"))+" ",1),jo]),s(M,{type:"button",class:"flex justify-center w-full text-sm lg:w-auto hover:bg-gray-200",variant:"gray",onClick:v},{right:i(T=>[s(u,{name:"PencilIcon",class:G(T.class)},null,8,["class"])]),default:i(()=>[q(" "+y(e.store[e.storeProp].template_name),1)]),_:1})])}}},qo={class:"mb-6"},Lo={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},Eo={class:"text-primary-800 font-medium mb-4 text-sm"},sn={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Object,default:null},type:{type:String,default:null}},setup(e){const o=e;function t(f){o.store[o.storeProp].notes=""+f.notes}return(f,v)=>{const b=x("BaseCustomInput");return r(),p("div",qo,[n("div",Lo,[s(Re,{type:e.type,onSelect:t},null,8,["type"])]),n("label",Eo,y(f.$t("invoices.notes")),1),s(b,{modelValue:e.store[e.storeProp].notes,"onUpdate:modelValue":v[0]||(v[0]=w=>e.store[e.storeProp].notes=w),"content-loading":e.store.isFetchingInitialSettings,fields:e.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"])])}}};var Oo="/build/img/tick.png";const No={class:"flex justify-between w-full"},Uo={class:"px-8 py-8 sm:p-6"},Fo={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},Ao=["src","alt","onClick"],zo=["alt"],Wo={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},an={setup(e){const o=Q(),t=H(""),f=B(()=>o.active&&o.componentName==="SelectTemplate"),v=B(()=>o.title);function b(){o.data.store[o.data.storeProp].template_name?t.value=o.data.store[o.data.storeProp].template_name:t.value=o.data.templates[0]}async function w(){await o.data.store.setTemplate(t.value),u()}function u(){o.closeModal(),setTimeout(()=>{o.$reset()},300)}return(M,T)=>{const C=x("BaseIcon"),L=x("BaseButton"),k=x("BaseModal");return r(),S(k,{show:a(f),onClose:u,onOpen:b},{header:i(()=>[n("div",No,[q(y(a(v))+" ",1),s(C,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:u})])]),default:i(()=>[n("div",Uo,[a(o).data?(r(),p("div",Fo,[(r(!0),p(K,null,te(a(o).data.templates,(l,h)=>(r(),p("div",{key:h,class:G([{"border border-solid border-primary-500":t.value===l.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"])},[n("img",{src:l.path,alt:l.name,class:"w-full",onClick:d=>t.value=l.name},null,8,Ao),t.value===l.name?(r(),p("img",{key:0,alt:l.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:Oo},null,8,zo)):O("",!0),n("span",{class:G(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":t.value===l.name,"text-gray-600":t.value!=l.name}])},y(l.name),3)],2))),128))])):O("",!0)]),n("div",Wo,[s(L,{class:"mr-3",variant:"primary-outline",onClick:u},{default:i(()=>[q(y(M.$t("general.cancel")),1)]),_:1}),s(L,{variant:"primary",onClick:T[0]||(T[0]=l=>w())},{left:i(l=>[s(C,{name:"SaveIcon",class:G(l.class)},null,8,["class"])]),default:i(()=>[q(" "+y(M.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},Yo={class:"flex justify-between w-full"},Ro={class:"item-modal"},Go=["onSubmit"],Xo={class:"px-8 py-8 sm:p-6"},Ho={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},rn={emits:["newItem"],setup(e,{emit:o}){const t=Q(),f=pe(),v=oe(),b=se();Ce(),Me();const{t:w}=ee(),u=H(!1),M=H(v.selectedCompanySettings.tax_per_item),T=B(()=>t.active&&t.componentName==="ItemModal"),C=B({get:()=>f.currentItem.price/100,set:g=>{f.currentItem.price=Math.round(g*100)}}),L=B({get:()=>f.currentItem.taxes.map(g=>{if(g)return W(U({},g),{tax_type_id:g.id,tax_name:g.name+" ("+g.percent+"%)"})}),set:g=>{f.$patch($=>{$.currentItem.taxes=g})}}),k=B(()=>M.value==="YES"),l={name:{required:j.withMessage(w("validation.required"),Z),minLength:j.withMessage(w("validation.name_min_length",{count:3}),ze(3))},description:{maxLength:j.withMessage(w("validation.description_maxlength",{count:255}),J(255))}},h=he(l,B(()=>f.currentItem)),d=B(()=>b.taxTypes.map(g=>W(U({},g),{tax_name:g.name+" ("+g.percent+"%)"})));We(()=>{h.value.$reset(),f.fetchItemUnits({limit:"all"})});async function _(){if(h.value.$touch(),h.value.$invalid)return!0;let g=W(U({},f.currentItem),{taxes:f.currentItem.taxes.map(I=>({tax_type_id:I.id,amount:C.value*I.percent/100,percent:I.percent,name:I.name,collective_tax:0}))});u.value=!0,await(f.isEdit?f.updateItem:f.addItem)(g).then(I=>{u.value=!1,I.data.data&&t.data&&t.refreshData(I.data.data),D()})}function D(){t.closeModal(),setTimeout(()=>{f.resetCurrentItem(),t.$reset(),h.value.$reset()},300)}return(g,$)=>{const I=x("BaseIcon"),X=x("BaseInput"),F=x("BaseInputGroup"),E=x("BaseMoney"),Y=x("BaseMultiselect"),A=x("BaseTextarea"),N=x("BaseInputGrid"),c=x("BaseButton"),m=x("BaseModal");return r(),S(m,{show:a(T),onClose:D},{header:i(()=>[n("div",Yo,[q(y(a(t).title)+" ",1),s(I,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:D})])]),default:i(()=>[n("div",Ro,[n("form",{action:"",onSubmit:Ye(_,["prevent"])},[n("div",Xo,[s(N,{layout:"one-column"},{default:i(()=>[s(F,{label:g.$t("items.name"),required:"",error:a(h).name.$error&&a(h).name.$errors[0].$message},{default:i(()=>[s(X,{modelValue:a(f).currentItem.name,"onUpdate:modelValue":$[0]||($[0]=P=>a(f).currentItem.name=P),type:"text",invalid:a(h).name.$error,onInput:$[1]||($[1]=P=>a(h).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),s(F,{label:g.$t("items.price")},{default:i(()=>[s(E,{key:a(v).selectedCompanyCurrency,modelValue:a(C),"onUpdate:modelValue":$[2]||($[2]=P=>R(C)?C.value=P:null),currency:a(v).selectedCompanyCurrency,class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency"])]),_:1},8,["label"]),s(F,{label:g.$t("items.unit")},{default:i(()=>[s(Y,{modelValue:a(f).currentItem.unit_id,"onUpdate:modelValue":$[3]||($[3]=P=>a(f).currentItem.unit_id=P),label:"name",options:a(f).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:g.$t("items.select_a_unit"),searchable:"","track-by":"id"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),a(k)?(r(),S(F,{key:0,label:g.$t("items.taxes")},{default:i(()=>[s(Y,{modelValue:a(L),"onUpdate:modelValue":$[4]||($[4]=P=>R(L)?L.value=P:null),options:a(d),label:"name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"id",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):O("",!0),s(F,{label:g.$t("items.description"),error:a(h).description.$error&&a(h).description.$errors[0].$message},{default:i(()=>[s(A,{modelValue:a(f).currentItem.description,"onUpdate:modelValue":$[5]||($[5]=P=>a(f).currentItem.description=P),rows:"4",cols:"50",invalid:a(h).description.$error,onInput:$[6]||($[6]=P=>a(h).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),n("div",Ho,[s(c,{class:"mr-3",variant:"primary-outline",type:"button",onClick:D},{default:i(()=>[q(y(g.$t("general.cancel")),1)]),_:1}),s(c,{loading:u.value,disabled:u.value,variant:"primary",type:"submit"},{left:i(P=>[s(I,{name:"SaveIcon",class:G(P.class)},null,8,["class"])]),default:i(()=>[q(" "+y(a(f).isEdit?g.$t("general.update"):g.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],40,Go)])]),_:1},8,["show"])}}};export{an as _,rn as a,tn as b,sn as c,nn as d,on as e};
